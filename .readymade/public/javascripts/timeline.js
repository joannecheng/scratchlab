// Generated by CoffeeScript 1.3.0
(function() {
  var TimeLine,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  TimeLine = (function() {

    TimeLine.name = 'TimeLine';

    function TimeLine() {
      this.data = __bind(this.data, this);

    }

    TimeLine.prototype.svg = null;

    TimeLine.prototype.points = [];

    TimeLine.prototype.handles = ["timeline"];

    TimeLine.prototype.name = "timeline";

    TimeLine.prototype.margin = {
      left: 40,
      right: 40,
      top: 40,
      bottom: 40
    };

    TimeLine.prototype.data = function(data, elem) {
      var line, x, xaxis, y, yaxis;
      this.points.push(data);
      if (this.points.length > 200) {
        this.points = this.points.slice(this.points.length - 200);
      }
      if (this.svg === null) {
        this.svg = d3.select("#" + this.name).append("svg");
        this.svg.attr({
          width: $("#" + this.name).width(),
          height: $("#" + this.name).height()
        });
        this.lineG = this.svg.append("g");
        this.lineG.attr("transform", "translate(" + this.margin.left + "," + this.margin.top + ")");
        this.path = this.lineG.append("path");
      }
      x = d3.time.scale().range([0, this.svg.attr("width") - (this.margin.left + this.margin.right)]).domain(d3.extent(this.points, function(d) {
        return d.timestamp;
      }));
      y = d3.scale.linear().range([this.svg.attr("height") - (this.margin.top + this.margin.bottom), 0]).domain([
        0, d3.max(this.points, function(d) {
          return d.value;
        })
      ]);
      xaxis = d3.svg.axis().scale(x).orient("bottom");
      yaxis = d3.svg.axis().scale(y).orient("left");
      this.svg.append("g").attr("class", "x axis").attr("transform", "translate(0," + (this.svg.attr("height") - this.margin.bottom) + ")").call(xaxis);
      this.svg.append("g").attr("class", "y axis").call(yaxis);
      line = d3.svg.line().x(function(d) {
        return x(d.timestamp);
      }).y(function(d) {
        return y(d.value);
      });
      return this.path.datum(this.points).attr("class", "time-line").attr("d", line).transition().duration(100);
    };

    return TimeLine;

  })();

  window.handlerTypes.push(TimeLine);

}).call(this);
